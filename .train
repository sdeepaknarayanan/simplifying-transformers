#!/bin/bash

echo loading gcc
module load gcc/6.3.0

echo loading python
module load python/3.8.5

echo loading cuda
module load cuda/11.1.1

echo loading cudnn
module load cudnn/7.6.4

echo installing pytorch
pip3 install torch==1.10.0+cu113 torchvision==0.11.1+cu113 torchaudio===0.10.0+cu113 -f https://download.pytorch.org/whl/cu113/torch_stable.html

echo installing transformers
pip install transformers

#echo installing lpips
#pip install lpips

echo loading eth_proxy
module load eth_proxy

bsub -n 4 -W 4:00 -N -J "B0-64" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B0-64.txt' python train_block_inf.py --block 0 --block_d_k 64 --storage_directory /cluster/scratch/winklerr/sitra
bsub -n 4 -W 4:00 -N -J "B0-32" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B0-32.txt' python train_block_inf.py --block 0 --block_d_k 32 --storage_directory /cluster/scratch/winklerr/sitra
bsub -n 4 -W 4:00 -N -J "B0-16" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B0-16.txt' python train_block_inf.py --block 0 --block_d_k 16 --storage_directory /cluster/scratch/winklerr/sitra

bsub -n 4 -W 4:00 -N -J "B1-64" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B1-64.txt' python train_block_inf.py --block 1 --block_d_k 64 --storage_directory /cluster/scratch/winklerr/sitra
bsub -n 4 -W 4:00 -N -J "B1-32" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B1-32.txt' python train_block_inf.py --block 1 --block_d_k 32 --storage_directory /cluster/scratch/winklerr/sitra
bsub -n 4 -W 4:00 -N -J "B1-16" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B1-16.txt' python train_block_inf.py --block 1 --block_d_k 16 --storage_directory /cluster/scratch/winklerr/sitra

bsub -n 4 -W 4:00 -N -J "B10-64" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B10-64.txt' python train_block_inf.py --block 10 --block_d_k 64 --storage_directory /cluster/scratch/winklerr/sitra
bsub -n 4 -W 4:00 -N -J "B10-32" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B10-32.txt' python train_block_inf.py --block 10 --block_d_k 32 --storage_directory /cluster/scratch/winklerr/sitra
bsub -n 4 -W 4:00 -N -J "B10-16" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B10-16.txt' python train_block_inf.py --block 10 --block_d_k 16 --storage_directory /cluster/scratch/winklerr/sitra

bsub -n 4 -W 4:00 -N -J "B11-64" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B11-64.txt' python train_block_inf.py --block 11 --block_d_k 64 --storage_directory /cluster/scratch/winklerr/sitra
bsub -n 4 -W 4:00 -N -J "B11-32" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B11-32.txt' python train_block_inf.py --block 11 --block_d_k 32 --storage_directory /cluster/scratch/winklerr/sitra
bsub -n 4 -W 4:00 -N -J "B11-16" -R "rusage[mem=8192, ngpus_excl_p=1]" -R "select[gpu_mtotal0>=11000]" -o 'B11-16.txt' python train_block_inf.py --block 11 --block_d_k 16 --storage_directory /cluster/scratch/winklerr/sitra